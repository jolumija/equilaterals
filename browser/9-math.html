<!DOCTYPE html>
<html>
<head>
<title>9 symmetries</title>
<script type="text/javascript" src="equilateral.js"></script>
<style type="text/css">
caption { border-bottom: 1px solid gray; margin:10px 5px 0 5px; }
th, td { padding:0px 10px; }	
td { font-family: courier; }
.a { color:#080; font-weight:bold; }
.r { color:red; font-weight: bold; }
.b { color:blue; font-weight: bold; }
.m { color:magenta; font-weight: bold; }
.num { text-align: right; }
.inline { display:inline-block; vertical-align: top; }
</style>
</head>
<body>
<div>@ic25</div>
<pre id="pre"></pre>
<div id="links"></div>
<object type="image/svg+xml" data="9a.svg"></object> 
<div id="post"></div>
 </div>
</body>

<script type="text/javascript">

const Geom = function(n) 
{
	const symm = 3 + 2*n
	const symm2 = parseInt(symm/2)

	const m = Math.PI / symm
	const angles = {
		all: [],
		m: m,
	}
	for (let a=1; a < symm; a++) 
		angles.all.push(a); // [1,2,...8]
	const as = []
	for (let a=0; a <= (symm-1)/2; ++a) 
		as.push(a) // [0,1,2,3,4]
	angles.cos = as.map(a => { return Math.cos(a*m) })
	angles.sin = as.map(a => { return Math.sin(a*m) })


	// symm=9 (x=>angles, y=>segments)
	// angle =>   1  2  3  4  5  6  7  8   red blue
	//                                     === ====
	// seg 0 => [ 8, 7, 6, 5, 4, 3, 2, 1 ]  1   10
	// seg 1 => [ 0, 8, 7, 6, 5, 4, 3, 2 ]  2   11
	// seg 2 => [ 1, 0, 8, 7, 6, 5, 4, 3 ]  3   12
	// seg 3 => [ 2, 1, 0, 8, 7, 6, 5, 4 ]  4   13
	// seg 4 => [ 3, 2, 1, 0, 8, 7, 6, 5 ]  5   14
	// seg 5 => [ 4, 3, 2, 1, 0, 8, 7, 6 ]  6   15
	// seg 6 => [ 5, 4, 3, 2, 1, 0, 8, 7 ]  7   16
	// seg 7 => [ 6, 5, 4, 3, 2, 1, 0, 8 ]  8   17
	// seg 8 => [ 7, 6, 5, 4, 3, 2, 1, 0 ]  9   18 
	const rows = []
	for (let r=0; r < symm; r++) { // segments
		const cols = []
		const first = symm + r
		for (let c=1; c < symm; c++) // angles
			cols.push((first - c)%symm)
		rows.push(cols)
	}
	const segments = []
	rows.forEach(row => {
		segments.push({
			next: row.map(r => { return r+symm })
		})
	})
	rows.forEach(row => {
		segments.push({
			next:row
		})
	})


	const xs = []
	const ys = []
	const L = ["a","b","c","d","e","f","g","h","i","j","k","l","m"]
	xs.push("1") // cos(0)
	ys.push("0") // cos(1)
	{
		let c = 0
		for (let x=0; x < symm2; x++, c++) { 
			xs.push(L[c]) 
		}
		for (let y=0; y < symm2; y++, c++) { 
			ys.push(L[c]) 
		}
	}
	function array(i) {
		const rows = []
		for (let a=0; a < symm2 + 1; a++) {
			const cols = []
			for (let b=0; b < symm2 + 1; b++)
				cols.push((a == b) ? i : 0)
			rows.push(cols)
		}
		return rows
	}
	const plus = array(+1)
	const minus = array(-1)

	//console.log("plus", JSON.stringify(plus, null, 2))
	//console.log("minus", JSON.stringify(minus, null, 2))


	const positions = [] // 1,15,2,16,3,17,4...
	{
		const xyp = []
		xyp.push(0) // 1,0
		for (let i=1; i <= 4; i++) { xyp.push(i) }
		for (let i=4; i >= 1; i--) { xyp.push(i) }

		for (let i=0; i < 2*symm; i++) {
			const p = { }
			if (i%2==0) {
				p.seg = 1 + (i)/2
				p.clazz = "r"
			} else {
				const diff = ((i+9)/2) % 9
				p.seg = 1 + 9 + diff
				p.clazz = "b"
			}
			const pos = xyp[i%symm]
			const x = (i < symm/2) || (i > 3*symm/2) // ok
			const y = !(i < symm) // ok
			positions.push(p)

			const seg = p.seg - 1
			segments[seg].x = x ? plus[pos] : minus[pos]
			segments[seg].y = y ? plus[pos] : minus[pos]
			segments[seg].pos = {
				p: pos,
				x: x,
				y: y
			}
		}
	}
	//segments.forEach(s => {
	//	console.log("segment", JSON.stringify(s))
	//})


	this.toString = function() { return `Geom n=${n} symm=${symm}` }
	this.symmetry = function() { return symm }
	this.segments = function() { return segments }
	this.rows     = function() { return rows }
	this.angles   = function() { return angles }

	this.xs = function() { return xs }
	this.ys = function() { return ys }

	this.zero = function() { // return new copies
		const zero = []
		for (let a=0; a < symm2 + 1; a++)
			zero.push(0)
		return zero
	}

	this.pos = function() { return positions }

	this.add = function(base, incr) {
		for (let i=0; i < base.length; i++) {
			base[i] += incr[i]
		}
	}

	this.segmentClass = function(s) {
		return s < symm ? "r" : "b"
	}
}

const g = new Geom(3)
const angles = g.angles()
//console.log(JSON.stringify(angles, null, 2))

//console.log(g.toString());
$("pre").innerHTML = g.toString()

const links = $("links")
const table_1 = elem("div", links, "inline")
const table_2 = elem("div", links, "inline")
const table_3 = elem("div", links, "inline")

{
	const t0 = elem("table", table_1)
	elem("caption", t0, "", "x:angles, y:segments, x,y:next segment")
	const tr = elem("tr", t0)
	elem("td", tr).innerHTML = "&nbsp;"
	angles.all.forEach(k => {
		elem("td", tr, "a num").innerHTML = k
	})
	elem("td", tr, "num", "x")
	elem("td", tr, "num", "y")
	elem("td", tr, "num", "p")
	elem("td", tr, "num", "~x,~y")
	let row = 0

	const xs = g.xs()
	const ys = g.ys()
	g.segments().forEach(s => {
		const tr = elem("tr", t0)
		const first = row < 9;
		const clazz = first ? "r" : "b"
		const name = row+1
		elem("td", t0, clazz + " num", name)
		s.next.forEach(col => {
			const clazz = first ? "b" : "r"
			const name = col + 1
			elem("td", t0, clazz + " num", name)
		})
		elem("td", t0, "m num", JSON.stringify(s.x))
		elem("td", t0, "m num", JSON.stringify(s.y))
		// debug
		const p = s.pos.p
		const x = s.pos.x ? "+" : "-"
		const y = s.pos.y ? "+" : "-"
		const xy = `${x}${xs[p]},${y}${ys[p]}`
		elem("td", t0, "num", p)
		elem("td", t0, "num", xy)

		row++
	})
}

/*{
	const t4 = elem("table", table_2)
	elem("caption", t4, "", "segments")
	function row(a, p, b) {
		const tr = elem("tr", t4)
		elem("td", tr, a[0], a[1])
		elem("td", tr, "", p)
		elem("td", tr, "m", b)
	}
	const xs = g.xs()
	const ys = g.ys()

	row(["","segment"], "p", "~x,~y")
	g.pos().forEach(r => {
		const p = r.p
		const x = r.x ? "+" : "-"
		const y = r.y ? "+" : "-"
		const xy = `${x}${xs[p]},${y}${ys[p]}`
		row([r.clazz + " num",r.seg], p, xy)
	})
}*/

{
	function row(t, a, b, c) {
		const tr = elem("tr", t)
		elem("td", tr, "m").innerHTML = a || "&nbsp;"
		elem("td", tr).innerHTML = b || "&nbsp;"
		elem("td", tr).innerHTML = c
	}
	const t0 = elem("table", table_3)
	elem("caption", t0, "", "Angle")
	row(t0, "m", "pi / " + g.symmetry(), angles.m)

	const t1 = elem("table", table_3)
	elem("caption", t1, "", "x coordinates")
	const cos = [ "1", "a", "b", "c", "d" ]
	for (let i=0; i < cos.length; i++) {
		row(t1, cos[i], `cos(${i}*m)`, angles.cos[i])
	}
	const t2 = elem("table", table_3)
	elem("caption", t2, "", "y coordinates")
	const sin = [ "0", "e", "f", "g", "h" ]
	for (let i=0; i < sin.length; i++) {
		row(t2, sin[i], `sin(${i}*m)`, angles.sin[i])
	}
}

{
	const t0 = elem("table", $("post"))
	const tr = elem("tr", t0)
	elem("th", tr, "", "angle")
	elem("th", tr, "", "segment")
	g.xs().forEach(x => { elem("th", tr, "num", x) })
	g.ys().forEach(y => { elem("th", tr, "num", y) })
	elem("td", tr, "", "vertex")

	function row(angle, s, xs, ys, v) {
		const tr = elem("tr", t0)
		elem("td", tr, "num a", angle)
		elem("td", tr, "num " + s[0], s[1])
		xs.forEach(x => { elem("td", tr, "m num", x) })
		ys.forEach(y => { elem("td", tr, "m num", y) })
		elem("td", tr, "num", v)
	}
	const seg = g.segments()


	const figure = [
		{ angle:0, vertex:"A" },
		{ angle:3, vertex:"B" },
		{ angle:2, vertex:"C" },
		{ angle:4, vertex:"D" },
		{ angle:3, vertex:"E" },
		{ angle:2, vertex:"0" }
	]

	const x0 = g.zero()
	const y0 = g.zero()
	row("", [" ", " "], x0, y0, "0")

	let lastSeg = 0
	figure.forEach(f => {
		const a = f.angle
		if (a <= 0) {
			lastSeg = 0
		} else {
			lastSeg = seg[lastSeg].next[a-1]
		}
		const s = lastSeg
		const x = seg[s].x
		const y = seg[s].y
		g.add(x0, x)
		g.add(y0, y)
		const clazz = g.segmentClass(s)
		row( a, [clazz, s+1],  x,  y)
		row("", [   "",  ""], x0, y0, f.vertex)
	})
}

/*

const table = elem("table", $("cos"))
function row(a, b, c, d) {
	const tr = elem("tr", table)
	elem("th", tr, "").innerHTML = a || "&nbsp;"
	elem("td", tr, "").innerHTML = b || "&nbsp;"
	elem("td", tr, "").innerHTML = c || "&nbsp;"
	elem("td", tr, "").innerHTML = d || "&nbsp;"
}

{
	const m = Math.PI / 9
	row("a", "pi / 9", m)
	row()
	const A = Math.cos(1*m)
	row("A", "cos(1*a)", A)
	row("B", "cos(2*a)", Math.cos(2*m))
	row("C", "cos(3*a)", Math.cos(3*m), "1/2")
	row("D", "cos(4*a)", Math.cos(4*m))
	row()
	const E = Math.sin(1*m)
	row("E", "sin(1*a)", E)
	row("F", "sin(2*a)", Math.sin(2*m))
	row("G", "sin(3*a)", Math.sin(3*m))
	row("H", "sin(4*a)", Math.sin(4*m))
	row()
	row("B", "A^2 + E^2", A*A - E*E)
	row("F", "2AE", 2*A*E)
	row("C", "A(4A^2 - 3)", A*(4*A*A - 3))
	row("G", "E(3 - 4E^2)", E*(3 - 4*E*E))

	row()
}

{
	const n = Math.PI / 18
	row("n", "pi / 18", n)

	for (let i=1; i <= 8; i++) {
		row(`cos(${i}*n)`, Math.cos(i*n))
	}
	const a = 1
	row("a", "1", a, "definition")

	const d16 = Math.sqrt(2 - 2*Math.cos(16*n))
	const d14 = Math.sqrt(2 - 2*Math.cos(14*n))

	const d10 = Math.sqrt(2 - 2*Math.cos(10*n))

	const A = a * d16
	const B = A * d14
	const D = B * d10

	row("A", "a * sqrt(2 - 2cos(16n))", A, "a*" + d16)
	row("B", "A * sqrt(2 - 2cos(14n))", B, "A*" + d14)
	row("D", "B * sqrt(2 - 2cos(10n))", D, "B*" + d10)

}



const a9 = Math.PI / 9

const cos = [1,2,3,4].map(a => { 
	return Math.cos(a*a9) 
})
for (let i=3; i >= 0; i--)
	cos.push(-cos[i])

const sqrts  = cos.map(a => { return Math.sqrt(2 - 2*a) } )

const A = 1
const B = Math.sqrt(A*A + A*A - 2*A*A*cos[6])
const C = Math.sqrt(A*A + B*B - 2*A*B*cos[5])
const D1 = Math.sqrt(A*A + C*C - 2*A*C*cos[4])
const D2 = Math.sqrt(B*B + B*B - 2*B*B*cos[4])



row("a", "2*pi / 9", a9)

for (let i=0; i < cos.length; i++) {
	row(`cos[${i}]`, `cos(${(i+1)}a)`, cos[i])
}
row()
for (let i=0; i < sqrts.length; i++) {
	row("-", `sqrt(2 - 2cos(${(i+1)}a))`, Math.sqrt(2 - 2 *cos[i]))
}
row()
row("A", "-", A)
row("B", "sqrt(A^2 + A^2 - 2A^2cos(7a))", B)
row("B", "sqrt(2 + 2cos(2a))", Math.sqrt(2 + 2*Math.cos(2*a9)))
row("C", "sqrt(A^2 + B^2 - 2ABcos(6a))",  C)
row("C", "sqrt(1 + B^2 + B)", Math.sqrt(1 + B*B + B))
row("D", "sqrt(A^2 + C^2 - 2ACcos(5a))",  D1, "sqrt(1 + C^2 + 2Ccos(4a))")
row("D", "sqrt(B^2 + B^2 - 2B^2cos(5a))", D2, "B*sqrt(2 + 2cos(4a))")
row("D", "1 + B", 1 + B, "decimal expansion hypotesis")
row("D", "sqrt((2-2cos(5a)*(2-2cos(7a)))", sqrts[4]*sqrts[6])
*/



/*
function rowAngles(table) {
	const tr = elem("tr", table)
	elem("th", tr, {}, "")
	for (let i=1; i<=8; i++)
		elem("th", tr, { }, i)
}
function rowRedBlues(table, reds, blues) {
	const tr = elem("tr", table)
	reds.forEach(r => {
		elem("td", tr, "r num", r)
	})
	blues.forEach(b => {
		elem("td", tr, "b num", b)
	})
}
function rowBlueReds(table, blues, reds) {
	const tr = elem("tr", table)
	blues.forEach(b => {
		elem("td", tr, "b num", b)
	})
	reds.forEach(r => {
		elem("td", tr, "r num", r)
	})
}
const t1 = elem("table", $("links"))
rowAngles(t1)
rowRedBlues(t1, [1],[18,17,16,15,14,13,12,11])
rowRedBlues(t1, [2],[10,18,17,16,15,14,13,12])
rowRedBlues(t1, [3],[11,10,18,17,16,15,14,13])
rowRedBlues(t1, [4],[12,11,10,18,17,16,15,14])
rowRedBlues(t1, [5],[13,12,11,10,18,17,16,15])
rowRedBlues(t1, [6],[14,13,12,11,10,18,17,16])
rowRedBlues(t1, [7],[15,14,13,12,11,10,18,17])
rowRedBlues(t1, [8],[16,15,14,13,12,11,10,18])
rowRedBlues(t1, [9],[17,16,15,14,13,12,11,10])
rowBlueReds(t1, [10],[9,8,7,6,5,4,3,2])
rowBlueReds(t1, [11],[1,9,8,7,6,5,4,3])
rowBlueReds(t1, [12],[2,1,9,8,7,6,5,4])
rowBlueReds(t1, [13],[3,2,1,9,8,7,6,5])
rowBlueReds(t1, [14],[4,3,2,1,9,8,7,6])
rowBlueReds(t1, [15],[5,4,3,2,1,9,8,7])
rowBlueReds(t1, [16],[6,5,4,3,2,1,9,8])
rowBlueReds(t1, [17],[7,6,5,4,3,2,1,9])
rowBlueReds(t1, [18],[8,7,6,5,4,3,2,1])
*/



</script>


</html>